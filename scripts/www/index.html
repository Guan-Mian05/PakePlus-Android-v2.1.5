<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨ç®±å­ï¼ˆæŒ‰é’®æ§åˆ¶ç‰ˆï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px 0;
        }

        /* æ¸¸æˆæ ‡é¢˜ */
        .game-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        /* æ¸¸æˆå®¹å™¨ï¼ˆé€‚é…ç§»åŠ¨ç«¯ï¼‰ */
        .game-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* 7åˆ—åœ°å›¾ï¼Œå¯è°ƒæ•´ */
            gap: 2px;
            background-color: #ccc;
            padding: 5px;
            border-radius: 8px;
            max-width: 350px;
            width: 90%;
        }

        /* åœ°å›¾æ ¼å­æ ·å¼ */
        .grid-cell {
            aspect-ratio: 1/1; /* æ­£æ–¹å½¢æ ¼å­ */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 20px;
        }

        /* å„ç±»å…ƒç´ æ ·å¼ */
        .wall {
            background-color: #666; /* å¢™å£-æ·±ç°è‰² */
        }

        .empty {
            background-color: #fff; /* ç©ºåœ°-ç™½è‰² */
        }

        .target {
            background-color: #ffeb3b; /* ç›®æ ‡ç‚¹-é»„è‰² */
            border: 2px dashed #f57f17;
        }

        .player {
            background-color: #2196f3; /* ç©å®¶-è“è‰² */
            border-radius: 50%; /* åœ†å½¢ç©å®¶ */
        }

        .box {
            background-color: #f44336; /* ç®±å­-çº¢è‰² */
            border-radius: 6px;
        }

        .box-on-target {
            background-color: #4caf50; /* ç®±å­åœ¨ç›®æ ‡ç‚¹ä¸Š-ç»¿è‰² */
            border-radius: 6px;
        }

        /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .controls {
            margin-top: 30px;
            display: grid;
            grid-template-areas:
                ". up ."
                "left down right";
            gap: 10px;
            max-width: 200px;
            width: 80%;
        }

        /* æ§åˆ¶æŒ‰é’®æ ·å¼ï¼ˆå¤§å°ºå¯¸ï¼Œæ–¹ä¾¿è§¦æ‘¸ï¼‰ */
        .control-btn {
            width: 60px;
            height: 60px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            background-color: #2196f3;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            touch-action: manipulation; /* ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸å“åº” */
        }

        .control-btn:active {
            background-color: #1976d2;
            transform: translateY(2px);
        }

        /* æŒ‰é’®å¸ƒå±€ */
        #up { grid-area: up; }
        #left { grid-area: left; }
        #down { grid-area: down; }
        #right { grid-area: right; }

        /* èƒœåˆ©æç¤º */
        .success-tip {
            margin-top: 20px;
            font-size: 18px;
            color: #4caf50;
            font-weight: bold;
            display: none; /* é»˜è®¤éšè— */
        }
    </style>
</head>
<body>
    <h1 class="game-title">æ¨ç®±å­ï¼ˆæŒ‰é’®æ§åˆ¶ç‰ˆï¼‰</h1>
    <div class="game-container" id="gameContainer"></div>
    <div class="success-tip" id="successTip">æ­å–œä½ ï¼é€šå…³å•¦ï¼ğŸ‰</div>
    <div class="controls">
        <button class="control-btn" id="up">â†‘</button>
        <button class="control-btn" id="left">â†</button>
        <button class="control-btn" id="down">â†“</button>
        <button class="control-btn" id="right">â†’</button>
    </div>

    <script>
        // 1. æ¸¸æˆåœ°å›¾æ•°æ®ï¼ˆäºŒç»´æ•°ç»„ï¼‰
        // 0=ç©ºåœ°, 1=å¢™å£, 2=ç›®æ ‡ç‚¹, 3=ç©å®¶, 4=ç®±å­
        const mapData = [
            [1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 4, 2, 0, 1],
            [1, 0, 0, 3, 0, 0, 1],
            [1, 0, 0, 0, 2, 0, 1],
            [1, 0, 4, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1]
        ];

        // 2. æ¸¸æˆçŠ¶æ€å˜é‡
        let gameMap = JSON.parse(JSON.stringify(mapData)); // æ·±æ‹·è´åœ°å›¾æ•°æ®
        let playerPos = { x: 3, y: 3 }; // ç©å®¶åˆå§‹ä½ç½®ï¼ˆå¯¹åº”mapDataä¸­çš„3ï¼‰
        const gameContainer = document.getElementById('gameContainer');
        const successTip = document.getElementById('successTip');

        // 3. åˆå§‹åŒ–æ¸¸æˆï¼ˆæ¸²æŸ“åœ°å›¾ï¼‰
        function initGame() {
            gameContainer.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
            for (let y = 0; y < gameMap.length; y++) {
                for (let x = 0; x < gameMap[y].length; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    
                    // æ ¹æ®åœ°å›¾å€¼è®¾ç½®æ ·å¼ç±»
                    switch (gameMap[y][x]) {
                        case 1:
                            cell.classList.add('wall');
                            break;
                        case 2:
                            cell.classList.add('target');
                            break;
                        case 3:
                            cell.classList.add('player');
                            // ç©å®¶åœ¨ç›®æ ‡ç‚¹ä¸Šçš„æ ·å¼
                            if (isTarget(x, y)) {
                                cell.style.background = '#2196f3';
                                cell.style.border = '2px solid #ffeb3b';
                            }
                            break;
                        case 4:
                            // ç®±å­åœ¨ç›®æ ‡ç‚¹ä¸Šçš„æ ·å¼
                            if (isTarget(x, y)) {
                                cell.classList.add('box-on-target');
                            } else {
                                cell.classList.add('box');
                            }
                            break;
                        default:
                            cell.classList.add('empty');
                    }

                    gameContainer.appendChild(cell);
                }
            }
        }

        // 4. åˆ¤æ–­æ˜¯å¦æ˜¯ç›®æ ‡ç‚¹
        function isTarget(x, y) {
            // åŸå§‹åœ°å›¾ä¸­çš„ç›®æ ‡ç‚¹ï¼ˆé¿å…ç§»åŠ¨åä¸¢å¤±ç›®æ ‡ç‚¹æ ‡è¯†ï¼‰
            return mapData[y][x] === 2;
        }

        // 5. ç§»åŠ¨ç©å®¶é€»è¾‘
        function movePlayer(dx, dy) {
            const newX = playerPos.x + dx;
            const newY = playerPos.y + dy;
            const nextX = newX + dx;
            const nextY = newY + dy;

            // è¾¹ç•Œåˆ¤æ–­ï¼šä¸èƒ½ç©¿å¢™
            if (gameMap[newY][newX] === 1) return;

            // æƒ…å†µ1ï¼šç§»åŠ¨åˆ°ç©ºåœ°/ç›®æ ‡ç‚¹
            if (gameMap[newY][newX] === 0 || gameMap[newY][newX] === 2) {
                // æ›´æ–°ç©å®¶ä½ç½®
                gameMap[playerPos.y][playerPos.x] = isTarget(playerPos.x, playerPos.y) ? 2 : 0;
                gameMap[newY][newX] = 3;
                playerPos.x = newX;
                playerPos.y = newY;
            }

            // æƒ…å†µ2ï¼šæ¨åŠ¨ç®±å­
            else if (gameMap[newY][newX] === 4) {
                // ç®±å­å‰æ–¹ä¸èƒ½æ˜¯å¢™å£æˆ–å¦ä¸€ä¸ªç®±å­
                if (gameMap[nextY][nextX] === 1 || gameMap[nextY][nextX] === 4) return;
                
                // ç§»åŠ¨ç®±å­
                gameMap[nextY][nextX] = 4;
                // æ›´æ–°ç©å®¶ä½ç½®
                gameMap[playerPos.y][playerPos.x] = isTarget(playerPos.x, playerPos.y) ? 2 : 0;
                gameMap[newY][newX] = 3;
                playerPos.x = newX;
                playerPos.y = newY;
            }

            // é‡æ–°æ¸²æŸ“åœ°å›¾
            initGame();
            // åˆ¤æ–­æ˜¯å¦é€šå…³
            checkWin();
        }

        // 6. é€šå…³åˆ¤æ–­ï¼ˆæ‰€æœ‰ç®±å­éƒ½åœ¨ç›®æ ‡ç‚¹ä¸Šï¼‰
        function checkWin() {
            let isWin = true;
            for (let y = 0; y < gameMap.length; y++) {
                for (let x = 0; x < gameMap[y].length; x++) {
                    // å­˜åœ¨ç®±å­ä¸åœ¨ç›®æ ‡ç‚¹ä¸Šï¼Œæœªé€šå…³
                    if (gameMap[y][x] === 4 && !isTarget(x, y)) {
                        isWin = false;
                        break;
                    }
                }
                if (!isWin) break;
            }
            // æ˜¾ç¤ºé€šå…³æç¤º
            if (isWin) {
                successTip.style.display = 'block';
                // ç¦ç”¨æŒ‰é’®
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.disabled = true;
                    btn.style.backgroundColor = '#90caf9';
                });
            }
        }

        // 7. ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('up').addEventListener('click', () => movePlayer(0, -1));
        document.getElementById('left').addEventListener('click', () => movePlayer(-1, 0));
        document.getElementById('down').addEventListener('click', () => movePlayer(0, 1));
        document.getElementById('right').addEventListener('click', () => movePlayer(1, 0));

        // 8. åˆå§‹åŒ–æ¸¸æˆ
        window.onload = initGame;
    </script>
</body>
</html>